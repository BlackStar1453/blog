# 如何在macOS备忘录中添加标签

## 重要说明

⚠️ **关键概念**：本系统使用的是macOS备忘录的**系统标签功能（Hashtags）**，而不是在正文中手动输入的`#标签`文本。

## 系统标签 vs 文本标签

### ❌ 错误方式（不会被识别）

在备忘录正文中直接输入文本：
```
这是我的想法 #thought #cmx
```

这种方式只是普通文本，**不会被系统识别为标签**。

### ✅ 正确方式（会被识别）

使用macOS备忘录的系统标签功能：

1. **在备忘录正文中输入 `#` 符号**
2. **系统会自动弹出标签建议**
3. **选择或创建标签**
4. **标签会以特殊样式显示（通常是蓝色或高亮）**

## 详细操作步骤

### 方法一：在正文中添加标签（推荐）

1. **打开备忘录应用**
   - 打开"备忘录"（Notes）应用

2. **创建或打开一个备忘录**
   - 点击右上角的"新建备忘录"按钮
   - 或打开现有备忘录

3. **在正文中输入 `#` 符号**
   - 在备忘录的任意位置输入 `#`
   - 系统会自动显示标签建议列表

4. **选择或创建标签**
   - 如果标签已存在，从列表中选择
   - 如果是新标签，继续输入标签名称（如 `thought`）
   - 按回车键确认

5. **验证标签已添加**
   - 标签应该显示为**可点击的蓝色文本**
   - 点击标签可以查看所有使用该标签的备忘录

### 方法二：使用标签浏览器

1. **打开标签浏览器**
   - 在备忘录应用中，点击左侧边栏底部的"标签"图标
   - 或使用菜单：视图 → 显示标签浏览器

2. **创建新标签**
   - 在标签浏览器中点击"+"按钮
   - 输入标签名称

3. **将标签添加到备忘录**
   - 选择备忘录
   - 从标签浏览器中拖拽标签到备忘录
   - 或在备忘录中输入 `#` 并选择标签

### 方法三：使用快捷键

1. **在备忘录中按 `#` 键**
2. **输入标签名称**
3. **按 `Tab` 或 `Enter` 确认**

## 支持的标签列表

根据系统配置，以下标签会被识别和处理：

| 标签 | 用途 | 是否发布到Mastodon |
|------|------|-------------------|
| `#thought` | 短想法和随想 | 需要同时添加 `#cmx` |
| `#日记` | 个人日记 | 需要同时添加 `#cmx` |
| `#读书` | 读书笔记 | 需要同时添加 `#cmx` |
| `#诗歌` | 诗歌作品 | 需要同时添加 `#cmx` |
| `#故事` | 故事和小说 | 需要同时添加 `#cmx` |
| `#旅行` | 旅行记录 | 需要同时添加 `#cmx` |
| `#翻译` | 翻译作品 | 需要同时添加 `#cmx` |
| `#技术` | 技术文章 | 需要同时添加 `#cmx` |
| `#引用` | 文章引用 | 需要同时添加 `#cmx` |
| `#随笔` | 随笔散文 | 需要同时添加 `#cmx` |
| `#分享` | 内容分享 | 需要同时添加 `#cmx` |
| `#图片` | 图片内容 | 需要同时添加 `#cmx` |
| `#cmx` | **Mastodon发布标记** | ✅ 必需 |

## 特殊标签说明

### `#cmx` 标签（重要！）

- **用途**：标记需要发布到Mastodon的备忘录
- **使用方法**：与其他标签一起使用
- **示例**：
  ```
  这是我今天的想法
  
  #thought #cmx
  ```

### 多标签使用

可以为一个备忘录添加多个标签：

```
这是一篇关于旅行的技术文章

#旅行 #技术 #cmx
```

## 验证标签是否正确添加

### 方法一：视觉检查

- 正确的标签应该显示为**蓝色可点击文本**
- 普通文本的 `#标签` 不会变色

### 方法二：使用标签浏览器

1. 打开标签浏览器
2. 查看标签列表
3. 点击标签查看关联的备忘录

### 方法三：使用同步脚本检查

运行以下命令查看系统识别到的标签：

```bash
./sync-notes.sh --list
```

如果输出显示"没有找到带标签的备忘录"，说明：
1. 没有使用系统标签功能
2. 或者标签没有正确添加

## 常见问题

### Q1: 为什么我添加了 `#thought` 但脚本没有识别？

**A**: 检查以下几点：
1. 是否使用了系统标签功能（标签应该是蓝色可点击的）
2. 是否运行了 Apple Cloud Notes Parser 提取标签数据
3. 标签名称是否正确（区分大小写）

### Q2: 如何查看所有带标签的备忘录？

**A**: 
1. 在备忘录应用中打开标签浏览器
2. 或运行命令：`./sync-notes.sh --list`

### Q3: 可以在一个备忘录中添加多个标签吗？

**A**: 可以！只需在备忘录中多次输入 `#` 并选择不同的标签。

### Q4: 标签可以包含中文吗？

**A**: 可以！系统支持中文标签，如 `#日记`、`#读书` 等。

### Q5: 如何删除标签？

**A**: 
1. 在备忘录中选中标签文本
2. 按 `Delete` 键删除
3. 或在标签浏览器中右键点击标签选择"删除"

## 完整示例

### 示例1：创建一个想法并发布到Mastodon

1. 打开备忘录应用
2. 创建新备忘录
3. 输入内容：
   ```
   今天学到了一个新的编程技巧，感觉很有用！
   
   #thought #cmx
   ```
4. 确保 `#thought` 和 `#cmx` 显示为蓝色可点击文本
5. 保存备忘录
6. 运行同步脚本：`./sync-notes.sh`

### 示例2：创建一篇读书笔记

1. 创建新备忘录
2. 输入内容：
   ```
   《挪威的森林》读后感
   
   这本书讲述了...
   
   #读书 #cmx
   ```
3. 确保标签正确添加
4. 运行同步脚本

### 示例3：创建一篇技术文章（不发布到Mastodon）

1. 创建新备忘录
2. 输入内容：
   ```
   Python异步编程指南
   
   详细内容...
   
   #技术
   ```
3. 注意：没有添加 `#cmx`，所以不会发布到Mastodon
4. 运行同步脚本

## 故障排除

### 问题：脚本显示"没有找到带标签的备忘录"

**解决步骤**：

1. **检查标签是否正确添加**
   - 打开备忘录应用
   - 检查标签是否显示为蓝色可点击文本
   - 如果不是，重新添加标签

2. **手动运行 Apple Cloud Notes Parser**
   ```bash
   cd apple_cloud_notes_parser
   export PATH="/opt/homebrew/opt/ruby/bin:$PATH"
   ruby notes_cloud_ripper.rb --mac ~/Library/Group\ Containers/group.com.apple.notes --one-output-folder
   ```

3. **检查生成的JSON文件**
   ```bash
   cat apple_cloud_notes_parser/output/notes_rip/json/all_notes_1.json | python3 -c "
   import json, sys
   data = json.load(sys.stdin)
   notes = data.get('notes', {})
   for key, note in notes.items():
       if note.get('hashtags'):
           print(f\"Note: {note.get('title', 'No title')}\")
           print(f\"Hashtags: {note['hashtags']}\")
           print()
   "
   ```

4. **重新运行同步脚本**
   ```bash
   ./sync-notes.sh --verbose
   ```

### 问题：标签添加后变成了普通文本

**原因**：可能是macOS版本不支持标签功能

**解决方案**：
- 确保macOS版本为 Big Sur (11.0) 或更高
- 更新备忘录应用到最新版本

## 技术说明

### 标签存储位置

macOS备忘录的标签信息存储在：
```
~/Library/Group Containers/group.com.apple.notes/NoteStore.sqlite
```

### 标签提取工具

本系统使用 [Apple Cloud Notes Parser](https://github.com/threeplanetssoftware/apple_cloud_notes_parser) 提取标签信息。

### 标签数据格式

提取的标签数据存储在JSON文件中：
```json
{
  "notes": {
    "123": {
      "title": "我的想法",
      "hashtags": ["thought", "cmx"],
      ...
    }
  }
}
```

## 参考资源

- [macOS备忘录官方文档](https://support.apple.com/guide/notes/welcome/mac)
- [Apple Cloud Notes Parser GitHub](https://github.com/threeplanetssoftware/apple_cloud_notes_parser)
- [备忘录同步到博客和Mastodon流程指南](./备忘录同步到博客和Mastodon流程指南.md)

---

*最后更新时间：2025-10-01*
